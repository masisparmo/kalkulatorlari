<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Perencanaan Olah Raga Lari / Jalan</title>
    
    <!-- Menggunakan Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Menggunakan Font Inter dari Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* Mengaplikasikan font Inter ke seluruh halaman */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Style tambahan untuk input number agar tidak menampilkan panah */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        /* Transisi untuk kemunculan elemen */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Styling untuk radio button custom */
        .plan-option:checked + label {
            border-color: #6366f1; /* indigo-500 */
            background-color: #eef2ff; /* indigo-50 */
            color: #4338ca; /* indigo-700 */
        }
        
        /* Styling untuk modal */
        .modal-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen py-10 px-4">
    <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-2xl w-full max-w-2xl">
        
        <!-- Header Aplikasi -->
        <div class="text-center mb-8">
            <div class="inline-block bg-indigo-100 text-indigo-600 p-3 rounded-full mb-4">
                <!-- Ikon Orang Berlari -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 12a3 3 0 1 0-6 0 3 3 0 0 0 6 0z"/><path d="M20.9 19.8A9 9 0 1 0 3.1 19.8"/><path d="m6.1 19-1.8 2.7"/><path d="m17.9 19 1.8 2.7"/></svg>
            </div>
            <h1 class="text-3xl font-extrabold text-gray-800 tracking-tight">Aplikasi Perencanaan Olah Raga Lari / Jalan</h1>
            <p class="text-gray-500 mt-2">Rencanakan sesi latihan Anda berdasarkan target Durasi atau Pace.</p>
        </div>

        <!-- Form Input -->
        <div class="space-y-6">
            <!-- Input Jarak -->
            <div>
                <label for="distance" class="block text-sm font-semibold text-gray-700 mb-2">Rencana Jarak Tempuh (km)</label>
                <div class="relative">
                    <input type="number" id="distance" name="distance" placeholder="Contoh: 5" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
                </div>
            </div>

            <!-- Pilihan Perencanaan -->
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-2">Rencana Berdasarkan</label>
                <div class="grid grid-cols-2 gap-3">
                    <input type="radio" name="planType" id="planByPace" value="pace" class="hidden plan-option" checked>
                    <label for="planByPace" class="block text-center p-3 border border-gray-300 rounded-lg cursor-pointer transition duration-200 font-medium">Pace</label>
                    
                    <input type="radio" name="planType" id="planByDuration" value="duration" class="hidden plan-option">
                    <label for="planByDuration" class="block text-center p-3 border border-gray-300 rounded-lg cursor-pointer transition duration-200 font-medium">Durasi</label>
                </div>
            </div>

            <!-- Input Pace (Default) -->
            <div id="paceInputContainer">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Target Pace per km</label>
                <div class="flex items-center space-x-3">
                    <input type="number" id="paceMinutes" name="paceMinutes" placeholder="Menit" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-center focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
                    <span class="text-gray-500 font-bold text-2xl">:</span>
                    <input type="number" id="paceSeconds" name="paceSeconds" placeholder="Detik" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-center focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
                </div>
            </div>

            <!-- Input Durasi (Hidden by default) -->
            <div id="durationInputContainer" class="hidden">
                <label class="block text-sm font-semibold text-gray-700 mb-2">Target Durasi (Jam:Menit:Detik)</label>
                <div class="grid grid-cols-3 gap-3">
                    <input type="number" id="durationHours" name="durationHours" placeholder="Jam" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-center focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
                    <input type="number" id="durationMinutes" name="durationMinutes" placeholder="Menit" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-center focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
                    <input type="number" id="durationSeconds" name="durationSeconds" placeholder="Detik" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-center focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
                </div>
            </div>
        </div>

        <!-- Tombol Aksi -->
        <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4">
            <button id="resetBtn" class="w-full bg-gray-200 text-gray-800 font-bold py-3 px-4 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-all duration-200 transform active:scale-95">
                Reset
            </button>
            <button id="calculateBtn" class="w-full bg-gradient-to-r from-indigo-500 to-blue-500 text-white font-bold py-3 px-4 rounded-lg hover:shadow-lg hover:from-indigo-600 hover:to-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 transform active:scale-95">
                Hitung Rencana
            </button>
        </div>

        <!-- Pesan Error -->
        <div id="error-message" class="mt-6 text-center text-red-600 font-medium hidden p-3 bg-red-50 rounded-lg"></div>

        <!-- Area Hasil -->
        <div id="results" class="mt-8 pt-6 border-t border-gray-200 hidden">
            <h2 class="text-xl font-bold text-gray-800 text-center mb-5">Rencana Latihan Anda</h2>
            <div class="space-y-4">
                <!-- Hasil Kalkulasi -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div class="bg-slate-50 p-4 rounded-lg text-center">
                        <span id="resultLabel1" class="text-sm font-medium text-gray-500">Target Durasi</span>
                        <p id="resultValue1" class="font-bold text-3xl text-indigo-600 mt-1">00:00:00</p>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-lg text-center">
                        <span id="resultLabel2" class="text-sm font-medium text-gray-500">Target Pace</span>
                        <p id="resultValue2" class="font-bold text-3xl text-indigo-600 mt-1">00:00 /km</p>
                    </div>
                     <!-- Kartu Hasil Jumlah Langkah Kaki -->
                    <div class="bg-slate-50 p-4 rounded-lg text-center">
                        <span class="text-sm font-medium text-gray-500">Estimasi Langkah</span>
                        <p id="resultValueSteps" class="font-bold text-3xl text-indigo-600 mt-1">0</p>
                    </div>
                </div>
                
                <!-- Hasil Kategori -->
                <div class="bg-slate-50 p-5 rounded-lg">
                    <div class="flex items-center justify-between">
                         <span class="font-medium text-gray-500">Kategori Aktivitas</span>
                         <span id="categoryResult" class="font-bold text-lg text-indigo-600 text-right"></span>
                    </div>
                    <p id="categoryDescription" class="text-sm text-gray-600 mt-2 text-justify"></p>
                </div>

                <!-- Fitur Gemini -->
                <div class="mt-6 text-center">
                    <button id="getTipsBtn" class="bg-gradient-to-r from-teal-400 to-blue-500 text-white font-bold py-3 px-6 rounded-lg hover:shadow-lg hover:from-teal-500 hover:to-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-all duration-200 transform active:scale-95">
                        âœ¨ Dapatkan Tips dari Coach Ai
                    </button>
                </div>

                <!-- Kontainer Hasil Gemini -->
                <div id="gemini-container" class="mt-6 hidden">
                    <div id="gemini-loader" class="flex justify-center items-center p-4">
                        <svg class="animate-spin h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                        <p class="ml-3 text-gray-600">Coach Ai sedang menyiapkan tips untuk Anda...</p>
                    </div>
                    <div id="gemini-tips" class="bg-indigo-50 p-5 rounded-lg text-gray-700 space-y-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal untuk API Key -->
    <div id="apiKeyModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50 hidden modal-overlay">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md transform scale-95 modal-content">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Masukkan Kunci API Gemini</h2>
            <p class="text-gray-600 mb-6">Untuk mendapatkan tips dari Coach Ai, Anda memerlukan Kunci API dari Google. Anda bisa mendapatkannya secara gratis.</p>
            
            <div>
                <label for="apiKeyInput" class="block text-sm font-semibold text-gray-700 mb-2">Kunci API Gemini Anda</label>
                <input type="password" id="apiKeyInput" placeholder="Masukkan kunci API di sini" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
            </div>

            <p class="text-xs text-gray-500 mt-4">
                Klik <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="text-indigo-600 hover:underline font-medium">di sini untuk mendapatkan Kunci API</a> di Google AI Studio. Cukup buat kunci baru dan salin ke sini.
            </p>

            <div class="mt-8 grid grid-cols-2 gap-4">
                <button id="cancelApiKeyBtn" class="w-full bg-gray-200 text-gray-800 font-bold py-3 px-4 rounded-lg hover:bg-gray-300 transition-all duration-200">Batal</button>
                <button id="saveApiKeyBtn" class="w-full bg-gradient-to-r from-indigo-500 to-blue-500 text-white font-bold py-3 px-4 rounded-lg hover:shadow-lg transition-all duration-200">Simpan & Dapatkan Tips</button>
            </div>
        </div>
    </div>


    <script>
        // Mendapatkan elemen-elemen dari DOM
        const distanceInput = document.getElementById('distance');
        const planTypeRadios = document.querySelectorAll('input[name="planType"]');
        const paceInputContainer = document.getElementById('paceInputContainer');
        const durationInputContainer = document.getElementById('durationInputContainer');
        const paceMinutesInput = document.getElementById('paceMinutes');
        const paceSecondsInput = document.getElementById('paceSeconds');
        const durationHoursInput = document.getElementById('durationHours');
        const durationMinutesInput = document.getElementById('durationMinutes');
        const durationSecondsInput = document.getElementById('durationSeconds');
        
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const resultsDiv = document.getElementById('results');
        const errorMessageDiv = document.getElementById('error-message');

        const resultLabel1 = document.getElementById('resultLabel1');
        const resultValue1 = document.getElementById('resultValue1');
        const resultLabel2 = document.getElementById('resultLabel2');
        const resultValue2 = document.getElementById('resultValue2');
        const resultValueSteps = document.getElementById('resultValueSteps');
        
        const categoryResultSpan = document.getElementById('categoryResult');
        const categoryDescriptionP = document.getElementById('categoryDescription');
        
        const getTipsBtn = document.getElementById('getTipsBtn');
        const geminiContainer = document.getElementById('gemini-container');
        const geminiLoader = document.getElementById('gemini-loader');
        const geminiTipsDiv = document.getElementById('gemini-tips');
        
        // Elemen Modal API Key
        const apiKeyModal = document.getElementById('apiKeyModal');
        const apiKeyInput = document.getElementById('apiKeyInput');
        const saveApiKeyBtn = document.getElementById('saveApiKeyBtn');
        const cancelApiKeyBtn = document.getElementById('cancelApiKeyBtn');
        const modalContent = apiKeyModal.querySelector('.modal-content');

        let currentResults = {};

        // Fungsi untuk toggle input berdasarkan pilihan
        planTypeRadios.forEach(radio => {
            radio.addEventListener('change', (e) => {
                if (e.target.value === 'pace') {
                    paceInputContainer.classList.remove('hidden');
                    durationInputContainer.classList.add('hidden');
                } else {
                    paceInputContainer.classList.add('hidden');
                    durationInputContainer.classList.remove('hidden');
                }
            });
        });

        const pad = (num) => String(num).padStart(2, '0');

        function getCategory(paceInSeconds) {
            if (paceInSeconds <= 0) return { name: "Tidak Valid", description: "Pace tidak boleh nol atau negatif." };
            if (paceInSeconds < 240) return { name: "Sprint / Lari Cepat", description: "Lari dengan kecepatan maksimal dalam jarak pendek. Ini adalah latihan anaerobik intensitas tinggi untuk membangun kekuatan dan kecepatan eksplosif." };
            if (paceInSeconds < 330) return { name: "Lari Interval", description: "Latihan yang menyelingi antara lari cepat dengan periode istirahat. Tujuannya adalah untuk meningkatkan kecepatan dan efisiensi lari." };
            if (paceInSeconds < 420) return { name: "Lari Tempo", description: "Lari dengan kecepatan 'cukup berat' yang masih bisa dipertahankan secara konsisten untuk periode waktu tertentu. Bertujuan untuk meningkatkan ambang laktat." };
            if (paceInSeconds < 555) return { name: "Lari Ringan / Jarak Jauh", description: "Pace yang stabil dan nyaman, di mana Anda masih bisa bercakap-cakap. Biasanya dilakukan untuk pemulihan atau membangun daya tahan aerobik." };
            if (paceInSeconds < 750) return { name: "Jalan Cepat / Power Walking", description: "Kecepatan yang membuat napas dan detak jantung sedikit meningkat. Aktivitas ini sudah tergolong sebagai olahraga kardio yang efektif." };
            return { name: "Jalan Santai (Strolling)", description: "Aktivitas berjalan dengan ritme yang sangat ringan, biasanya dilakukan untuk rekreasi tanpa target kebugaran yang spesifik." };
        }
        
        function getEstimatedCadence(paceInSeconds) {
            if (paceInSeconds < 240) return 185; // Sprint: ~185+ spm
            if (paceInSeconds < 330) return 175; // Interval: ~175-185 spm
            if (paceInSeconds < 420) return 170; // Tempo: ~165-175 spm
            if (paceInSeconds < 555) return 160; // Lari Ringan: ~150-165 spm
            if (paceInSeconds < 750) return 130; // Jalan Cepat: ~120-135 spm
            return 115; // Jalan Santai: ~110-120 spm
        }

        function showError(message) {
            errorMessageDiv.textContent = message;
            errorMessageDiv.classList.remove('hidden');
            resultsDiv.classList.add('hidden');
        }

        function hideError() {
            errorMessageDiv.classList.add('hidden');
        }

        function calculate() {
            hideError();
            const distance = parseFloat(distanceInput.value);
            if (isNaN(distance) || distance <= 0) {
                showError('Harap masukkan jarak yang valid (lebih dari 0).');
                return;
            }

            const planType = document.querySelector('input[name="planType"]:checked').value;
            let totalPaceInSeconds, totalDurationInSeconds, category;

            if (planType === 'pace') {
                const paceMinutes = parseInt(paceMinutesInput.value) || 0;
                const paceSeconds = parseInt(paceSecondsInput.value) || 0;
                if ((paceMinutes <= 0 && paceSeconds <= 0) || paceMinutes < 0 || paceSeconds < 0 || paceSeconds >= 60) {
                    showError('Harap masukkan pace yang valid.');
                    return;
                }
                totalPaceInSeconds = (paceMinutes * 60) + paceSeconds;
                totalDurationInSeconds = totalPaceInSeconds * distance;
                const hours = Math.floor(totalDurationInSeconds / 3600);
                const minutes = Math.floor((totalDurationInSeconds % 3600) / 60);
                const seconds = Math.round(totalDurationInSeconds % 60);
                resultLabel1.textContent = "Estimasi Durasi";
                resultValue1.textContent = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
                resultLabel2.textContent = "Target Pace";
                resultValue2.textContent = `${pad(paceMinutes)}:${pad(paceSeconds)} /km`;
                currentResults = { distance, paceMinutes, paceSeconds, duration: resultValue1.textContent };
            } else {
                const hours = parseInt(durationHoursInput.value) || 0;
                const minutes = parseInt(durationMinutesInput.value) || 0;
                const seconds = parseInt(durationSecondsInput.value) || 0;
                if ((hours <= 0 && minutes <= 0 && seconds <= 0) || hours < 0 || minutes < 0 || seconds < 0 || minutes >= 60 || seconds >= 60) {
                    showError('Harap masukkan durasi yang valid.');
                    return;
                }
                totalDurationInSeconds = (hours * 3600) + (minutes * 60) + seconds;
                totalPaceInSeconds = totalDurationInSeconds / distance;
                const paceMinutes = Math.floor(totalPaceInSeconds / 60);
                const paceSeconds = Math.round(totalPaceInSeconds % 60);
                resultLabel1.textContent = "Target Durasi";
                resultValue1.textContent = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
                resultLabel2.textContent = "Estimasi Pace";
                resultValue2.textContent = `${pad(paceMinutes)}:${pad(paceSeconds)} /km`;
                currentResults = { distance, paceMinutes, paceSeconds, duration: resultValue1.textContent };
            }

            const estimatedCadence = getEstimatedCadence(totalPaceInSeconds);
            const totalDurationInMinutes = totalDurationInSeconds / 60;
            const estimatedTotalSteps = Math.round(estimatedCadence * totalDurationInMinutes);
            resultValueSteps.textContent = estimatedTotalSteps.toLocaleString('id-ID');
            currentResults.estimatedSteps = estimatedTotalSteps;

            const speedKmh = 3600 / totalPaceInSeconds;
            category = getCategory(totalPaceInSeconds);
            categoryResultSpan.textContent = category.name;
            categoryDescriptionP.textContent = category.description;
            currentResults.speedKmh = speedKmh.toFixed(2);
            currentResults.categoryName = category.name;

            resultsDiv.classList.remove('hidden');
            geminiContainer.classList.add('hidden');
            geminiTipsDiv.innerHTML = '';
        }
        
        function resetCalculator() {
            distanceInput.value = '';
            paceMinutesInput.value = '';
            paceSecondsInput.value = '';
            durationHoursInput.value = '';
            durationMinutesInput.value = '';
            durationSecondsInput.value = '';
            hideError();
            resultsDiv.classList.add('hidden');
            geminiContainer.classList.add('hidden');
            document.getElementById('planByPace').checked = true;
            paceInputContainer.classList.remove('hidden');
            durationInputContainer.classList.add('hidden');
            distanceInput.focus();
        }

        function formatGeminiResponse(text) {
            return text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                       .replace(/^\* (.*$)/gm, '<li class="ml-5 list-disc">$1</li>')
                       .replace(/^(?!<li).*/gm, (match) => {
                           if (match.trim() === '') return '';
                           return `<p>${match}</p>`;
                       })
                       .replace(/<\/li><p>/g, '</li>')
                       .replace(/<\/p>(\s*<li)/g, '</ul>$1')
                       .replace(/(<li.*<\/li>)(?![\s\S]*<li)/, '$1</ul>')
                       .replace(/(<li>.*)/, '<ul>$1');
        }

        async function getTrainingTips(apiKey) {
            if (!currentResults.distance) {
                showError("Harap hitung dulu rencana Anda sebelum meminta tips.");
                return;
            }

            geminiContainer.classList.remove('hidden');
            geminiLoader.classList.remove('hidden');
            geminiTipsDiv.classList.add('hidden');
            geminiTipsDiv.innerHTML = '';

            const prompt = `Anda adalah "Coach Ai", seorang pelatih olah raga lari dan jalan kaki virtual dengan pengalaman puluhan tahun. Anda dikenal bijak, memotivasi, dan memberikan saran yang praktis.
Seorang pengguna sedang merencanakan aktivitas dengan data berikut:
- Rencana Jarak: ${currentResults.distance} km
- Target Durasi: ${currentResults.duration}
- Target Pace: ${currentResults.paceMinutes} menit ${currentResults.paceSeconds} detik per km
- Kecepatan: ${currentResults.speedKmh} km/jam
- Kategori Aktivitas: ${currentResults.categoryName}
- Estimasi Jumlah Langkah: ${currentResults.estimatedSteps.toLocaleString('id-ID')} langkah

Berdasarkan rencana ini, berikan 3-5 tips latihan yang singkat, padat, dan sangat relevan dalam format poin-poin (gunakan tanda *). Tips harus memotivasi dan mudah dipahami. Fokus pada area seperti:
1. Saran persiapan sebelum lari (pemanasan, dll).
2. Strategi saat berlari untuk mencapai target ini.
3. Saran pemulihan setelah menyelesaikan latihan ini.
4. Motivasi untuk menjalankan rencana ini.
5. Motivasi agar berolah raga rutin minimal seminggu 2x dengan durasi total 120 menit.

Gunakan bahasa Indonesia yang santai dan menyemangati. Mulailah dengan sapaan positif dan panggil diri Anda "Coach Ai".`;
            
            try {
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API request failed: ${errorData.error?.message || response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    const rawText = result.candidates[0].content.parts[0].text;
                    geminiTipsDiv.innerHTML = formatGeminiResponse(rawText);
                } else {
                    throw new Error("Respons dari API tidak valid atau kosong.");
                }

            } catch (error) {
                console.error("Error fetching Gemini tips:", error);
                geminiTipsDiv.innerHTML = `<p class="text-red-500 text-center">Maaf, terjadi kesalahan: ${error.message}. Pastikan Kunci API Anda benar dan coba lagi.</p>`;
            } finally {
                geminiLoader.classList.add('hidden');
                geminiTipsDiv.classList.remove('hidden');
            }
        }
        
        // --- Fungsi Modal ---
        function openModal() {
            const savedKey = localStorage.getItem('geminiApiKey');
            if (savedKey) {
                apiKeyInput.value = savedKey;
            }
            apiKeyModal.classList.remove('hidden');
            setTimeout(() => {
                apiKeyModal.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95');
                modalContent.classList.add('scale-100');
            }, 10);
        }

        function closeModal() {
            apiKeyModal.classList.add('opacity-0');
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-95');
            setTimeout(() => {
                apiKeyModal.classList.add('hidden');
            }, 300);
        }

        // --- Event Listeners ---
        calculateBtn.addEventListener('click', calculate);
        resetBtn.addEventListener('click', resetCalculator);
        getTipsBtn.addEventListener('click', () => {
             if (!currentResults.distance) {
                showError("Harap hitung dulu rencana Anda sebelum meminta tips.");
                return;
            }
            openModal();
        });

        // Event Listeners untuk Modal
        saveApiKeyBtn.addEventListener('click', () => {
            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
                alert("Harap masukkan Kunci API Anda.");
                return;
            }
            localStorage.setItem('geminiApiKey', apiKey);
            closeModal();
            getTrainingTips(apiKey);
        });
        cancelApiKeyBtn.addEventListener('click', closeModal);
        apiKeyModal.addEventListener('click', (e) => {
            if (e.target === apiKeyModal) {
                closeModal();
            }
        });

    </script>
</body>
</html>
